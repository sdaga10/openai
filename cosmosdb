

variable "resource_group_name" {
  description = "The name of the resource group where the Cosmos DB will be created. This must already exist."
  type        = string
}

data "azurerm_resource_group" "cosmosdb_rg" {
  name = var.resource_group_name
}

provider "azurerm" {
  version = "=2.40.0"
}

resource "azurerm_cosmosdb_account" "cosmosdb" {
  name                = "cosmosdb-${random_integer.unique_number.result}"
  location            = data.azurerm_resource_group.cosmosdb_rg.location
  resource_group_name = data.azurerm_resource_group.cosmosdb_rg.name

  offer_type     = "Standard"
  consistency_level = "ConsistentPrefix"

  # Tags
  tags = {
    environment = "test"
    cost_center = "cc123"
  }
}

# Create a random integer to use as part of the CosmosDB name
resource "random_integer" "unique_number" {
  min = 100000
  max = 999999
}
